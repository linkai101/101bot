const Discord = require('discord.js');
const { oneLine } = require('common-tags');
const Command = require('../base');

const path = require('path');
const config = require(path.join(__dirname, '..', '..', '..', '..', '..', 'config', 'config.json'));

module.exports = class PingCommand extends Command {
	constructor(client) {
		super(client, {
			name: 'ping',
			group: 'util',
			memberName: 'ping',
			description: 'Checks the bot\'s ping to the Discord server',
			throttling: {
				usages: 3,
				duration: 10
			}
		});
	}

	async run(msg) {
		const calcPingMessage = new Discord.MessageEmbed()
			.setColor(config.embedSettings.color)
			.setAuthor('Pong!', 'https://images.emojiterra.com/google/android-nougat/512px/1f3d3.png', '')
			.setDescription("Calculating ping...")
			.setFooter(config.embedSettings.footer, config.embedSettings.footer_url);
		
		let pingingMessage = await msg.channel.send(calcPingMessage);

		const pingMessage = new Discord.MessageEmbed()
            .setColor(config.embedSettings.color)
            .setAuthor('Pong!', 'https://images.emojiterra.com/google/android-nougat/512px/1f3d3.png', '')
            .addFields(
				{ name: 'Roundtrip', value:  
					`${(pingingMessage.editedTimestamp || pingingMessage.createdTimestamp) - (msg.editedTimestamp || msg.createdTimestamp)} ms`,
					inline: false 
				}, 
                { name: 'Heartbeat', value:  `${Math.round(this.client.ws.ping)} ms`, inline: false }, 
            )
			.setFooter(config.embedSettings.footer, config.embedSettings.footer_url);
		
		msg.channel.send(pingMessage);
		pingingMessage.delete();
			
		/*const pingMsg = await msg.reply('Pinging...');
		return pingMsg.edit(oneLine`
			${msg.channel.type !== 'dm' ? `${msg.author},` : ''}
			Pong! The message round-trip took ${
				(pingMsg.editedTimestamp || pingMsg.createdTimestamp) - (msg.editedTimestamp || msg.createdTimestamp)
			}ms.
			${this.client.ws.ping ? `The heartbeat ping is ${Math.round(this.client.ws.ping)}ms.` : ''}
		`);*/
	}
};
